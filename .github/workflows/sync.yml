name: Sync luci-app-v2ray-server from kiddin9/kwrt-packages

on:
  schedule:
    - cron: '0 3 * * *'          # 每天 UTC 3:00 ≈ 北京时间 11:00
  workflow_dispatch:             # 支持手动触发

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout target repo
        uses: actions/checkout@v4
        with:
          path: target

      - name: Sync subdirectory from source
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
        with:
          target_repo_token: ${{ secrets.GITHUB_TOKEN }}
          upstream_sync_branch: main
          upstream_sync_repo: kiddin9/kwrt-packages
          upstream_sync_files: |
            luci-app-v2ray-server
          git_config_user: GitHub Action
          git_config_email: action@github.com
          commit_message: |
            chore: sync luci-app-v2ray-server from upstream
            Skip-ci: true

      - name: Push changes
        working-directory: target
        run: |
          git push origin HEAD:main || echo "No changes to push"
